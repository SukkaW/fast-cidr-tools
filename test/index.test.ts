import { expect } from 'chai';
import { merge, exclude } from '../src';
// import { merge, exclude } from '../build/debug.js';

describe('cidr-tools-wasm', () => {
  // it('exports', () => {
  //   expect(m.merge).to.eql(merge);
  //   expect(m.exclude).to.eql(exclude);
  //   expect(m.expand).to.eql(expand);
  //   expect(m.overlap).to.eql(overlap);
  //   expect(m.contains).to.eql(contains);
  //   expect(m.normalize).to.eql(normalize);
  //   expect(m.parse).to.eql(parse);
  // });

  it('merge', () => {
    expect(merge(['1.0.0.0', '1.0.0.1'])).to.eql(['1.0.0.0/31']);
    expect(merge(['1.0.0.0/24', '1.0.1.0/24'])).to.eql(['1.0.0.0/23']);
    expect(merge(['1.0.0.0/24', '1.0.0.0'])).to.eql(['1.0.0.0/24']);
    expect(merge(['1.0.0.0/24', '1.0.0.0/12'])).to.eql(['1.0.0.0/12']);
    expect(merge(['0.0.0.0/8', '1.0.0.0/8'])).to.eql(['0.0.0.0/7']);
    expect(merge(['4.0.0.0/8', '4.0.0.0/12', '4.0.0.0/16'])).to.eql(['4.0.0.0/8']);
    expect(merge(['0.0.0.1/32', '0.0.0.2/32'])).to.eql(['0.0.0.1/32', '0.0.0.2/32']);
    expect(merge(['0.0.1.0/24', '0.0.2.0/24', '0.0.3.0/24', '0.0.4.0/24'])).to.eql(['0.0.2.0/23', '0.0.1.0/24', '0.0.4.0/24']);
    expect(merge(['0.0.175.0/24', '0.0.176.0/21', '0.0.184.0/21', '0.0.192.0/24'])).to.eql(['0.0.176.0/20', '0.0.175.0/24', '0.0.192.0/24']);
    expect(merge(['0.0.176.0/21', '0.0.184.0/21', '0.0.192.0/24'])).to.eql(['0.0.176.0/20', '0.0.192.0/24']);
  });

  it('exclude', () => {
    expect(exclude(['1.0.0.0/23'], ['1.0.1.0/24'])).to.eql(['1.0.0.0/24']);
    expect(exclude(['1.0.0.0/24'], ['1.0.0.0/16'])).to.eql([]);
    expect(exclude(['1.0.0.0/24'], ['1.0.0.0'])).to.eql(['1.0.0.128/25', '1.0.0.64/26', '1.0.0.32/27', '1.0.0.16/28', '1.0.0.8/29', '1.0.0.4/30', '1.0.0.2/31', '1.0.0.1/32']);
    expect(exclude(['10.11.0.0/16'], ['10.11.70.0/24'])).to.eql(['10.11.0.0/18', '10.11.64.0/22', '10.11.68.0/23', '10.11.128.0/17', '10.11.96.0/19', '10.11.80.0/20', '10.11.72.0/21', '10.11.71.0/24']);
    expect(exclude(['0.0.0.0/30'], ['0.0.0.1/32', '0.0.0.2/32'])).to.eql(['0.0.0.0/32', '0.0.0.3/32']);
    expect(exclude(['0.0.0.0/0'], ['127.0.0.0/1'])).to.eql(['128.0.0.0/1']);
  });

  it('exclude', () => {
    expect(exclude(['1.0.0.0/23'], ['1.0.1.0/24'], true)).to.eql(['1.0.0.0/24']);
    expect(exclude(['1.0.0.0/24'], ['1.0.0.0/16'], true)).to.eql([]);
    expect(exclude(['1.0.0.0/24'], ['1.0.0.0'], true)).to.eql(['1.0.0.1/32', '1.0.0.2/31', '1.0.0.4/30', '1.0.0.8/29', '1.0.0.16/28', '1.0.0.32/27', '1.0.0.64/26', '1.0.0.128/25']);
    expect(exclude(['10.11.0.0/16'], ['10.11.70.0/24'], true)).to.eql(['10.11.0.0/18', '10.11.64.0/22', '10.11.68.0/23', '10.11.71.0/24', '10.11.72.0/21', '10.11.80.0/20', '10.11.96.0/19', '10.11.128.0/17']);
    expect(exclude(['0.0.0.0/30'], ['0.0.0.1/32', '0.0.0.2/32'], true)).to.eql(['0.0.0.0/32', '0.0.0.3/32']);
    expect(exclude(['0.0.0.0/0'], ['127.0.0.0/1'], true)).to.eql(['128.0.0.0/1']);
  });
});
